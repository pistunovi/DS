# Ð£ Ñ„Ð°Ð¹Ð»Ñ– theory_of_gaim.xlsx Ð¼Ñ–ÑÑ‚Ð¸Ñ‚ÑŒÑÑ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ, Ð² ÑÐºÑ–Ð¹ Ð¿ÐµÑ€ÑˆÑ– 3 Ñ€ÑÐ´ÐºÐ¸ 
# Ð²Ð¸Ð·Ð½Ð°Ñ‡Ð°ÑŽÑ‚ÑŒ Ñ‚Ð¸Ð¿ ÑÑ‚Ñ€Ð°Ñ‚ÐµÐ³Ñ–Ñ—. 4 ÑÑ‚Ð¾Ð²Ð¿Ñ†Ñ– Ð²Ð¸Ð·Ð½Ð°Ñ‡Ð°ÑŽÑ‚ÑŒ ÑÑ‚Ð°Ð½ Ð¿Ñ€Ð¸Ñ€Ð¾Ð´Ð¸. 
# Ð§ÐµÑ‚Ð²ÐµÑ€Ñ‚Ð¸Ð¹ Ñ€ÑÐ´Ð¾Ðº Ð´Ð°Ñ” Ð·Ð½Ð°Ñ‡ÐµÐ½Ð½Ñ Ñ–Ð¼Ð¾Ð²Ñ–Ñ€Ð½Ð¾ÑÑ‚Ñ– Ð½Ð°ÑÑ‚Ð°Ð½Ð½Ñ ÑÑ‚Ð°Ð½Ñƒ Ð¿Ñ€Ð¸Ñ€Ð¾Ð´Ð¸. 
# Ð”Ð»Ñ ÐºÐ¾Ñ€ÐµÐºÑ‚Ð½Ð¾Ñ— Ñ€Ð¾Ð±Ð¾Ñ‚Ð¸ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¸ Ñ‚Ñ€ÐµÐ±Ð° Ð¿Ñ€Ð¸Ð±Ñ€Ð°Ñ‚Ð¸ Ð½Ð°Ð·Ð²Ð¸ ÑÑ‚Ñ€Ð°Ñ‚ÐµÐ³Ñ–Ð¹ (Ð1â€¦Ð3) 
# Ñ– Ð½Ð°Ð·Ð²Ð¸ ÑÑ‚Ð°Ð½Ñ–Ð² Ð¿Ñ€Ð¸Ñ€Ð¾Ð´Ð¸ (S1â€¦S4). 
# Ð¢Ð°ÐºÐ¾Ð¶ Ð´Ð¾Ð´Ð°Ð½Ð¾ Ñ€ÑÐ´Ð¾Ðº Ñ–Ð¼Ð¾Ð²Ñ–Ñ€Ð½Ð¾ÑÑ‚Ñ– (p) Ð½Ð°ÑÑ‚Ð°Ð½Ð½Ñ ÑÑ‚Ð°Ð½Ñ–Ð² Ð¿Ñ€Ð¸Ñ€Ð¾Ð´Ð¸. 
# Ð£ Ñ€Ð¾Ð±Ð¾Ñ‡Ð¾Ð¼Ñƒ Ð²Ð°Ñ€Ñ–Ð°Ð½Ñ‚Ñ– Ñ„Ð°Ð¹Ð»Ñƒ  Ð´Ð¾Ð´Ð°Ð½Ð¾ Ñ‚Ð¾Ñ‡Ð½Ñ–ÑÑ‚ÑŒ (q)  Ð²Ð¸Ð·Ð½Ð°Ñ‡ÐµÐ½Ð½Ñ Ñ–Ð¼Ð¾Ð²Ñ–Ñ€Ð½Ð¾ÑÑ‚Ñ–.

# ÐŸÐ¾ÑÑÐ½ÐµÐ½Ð½Ñ ÐºÐ¾Ð´Ñƒ
#1.	payoffs â†’ Ð¼Ð°Ñ‚Ñ€Ð¸Ñ†Ñ Ð²Ð¸Ð³Ñ€Ð°ÑˆÑ–Ð² ÑÑ‚Ñ€Ð°Ñ‚ÐµÐ³Ñ–Ð¹ (Ñ€ÑÐ´ÐºÐ¸) Ð´Ð»Ñ ÐºÐ¾Ð¶Ð½Ð¾Ð³Ð¾ ÑÑ‚Ð°Ð½Ñƒ Ð¿Ñ€Ð¸Ñ€Ð¾Ð´Ð¸ (ÑÑ‚Ð¾Ð²Ð¿Ñ†Ñ–)
#2.	probabilities â†’ Ð¹Ð¼Ð¾Ð²Ñ–Ñ€Ð½Ð¾ÑÑ‚Ñ– Ð½Ð°ÑÑ‚Ð°Ð½Ð½Ñ ÑÑ‚Ð°Ð½Ñ–Ð² Ð¿Ñ€Ð¸Ñ€Ð¾Ð´Ð¸
#3.	ÐœÐµÑ‚Ð¾Ð´Ð¸ Ð´Ð»Ñ Ð½ÐµÐ²Ñ–Ð´Ð¾Ð¼Ð¸Ñ… Ð¹Ð¼Ð¾Ð²Ñ–Ñ€Ð½Ð¾ÑÑ‚ÐµÐ¹:
#o	ÐœÐ°ÐºÑÐ¸Ð¼Ñ–Ð½ â†’ Ð¼Ð°ÐºÑÐ¸Ð¼Ñ–Ð·ÑƒÑ” Ð¼Ñ–Ð½Ñ–Ð¼Ð°Ð»ÑŒÐ½Ð¸Ð¹ Ð²Ð¸Ð³Ñ€Ð°Ñˆ
#o	ÐœÐ°ÐºÑÐ¸Ð¼Ð°ÐºÑ â†’ Ð¼Ð°ÐºÑÐ¸Ð¼Ñ–Ð·ÑƒÑ” Ð¼Ð°ÐºÑÐ¸Ð¼Ð°Ð»ÑŒÐ½Ð¸Ð¹ Ð²Ð¸Ð³Ñ€Ð°Ñˆ
#o	Ð›Ð°Ð¿Ð»Ð°Ñ â†’ ÑÐµÑ€ÐµÐ´Ð½Ñ” Ð²Ð¸Ð³Ñ€Ð°ÑˆÑ–Ð² Ð´Ð»Ñ Ð²ÑÑ–Ñ… ÑÑ‚Ð°Ð½Ñ–Ð²
#o	Ð“ÑƒÑ€Ð²Ñ–Ñ†Ð° â†’ ÐºÐ¾Ð¼Ð¿Ñ€Ð¾Ð¼Ñ–Ñ Ð¼Ñ–Ð¶ Ð¼Ð°ÐºÑÐ¸Ð¼Ñ–Ð½ Ñ‚Ð° Ð¼Ð°ÐºÑÐ¸Ð¼Ð°ÐºÑ
#4.	ÐœÐµÑ‚Ð¾Ð´ Ð±Ñ–Ð»ÑŒÑˆÐ¾ÑÑ‚Ñ– â†’ Ð¾Ð±Ð¸Ñ€Ð°Ñ”Ð¼Ð¾ ÑÑ‚Ñ€Ð°Ñ‚ÐµÐ³Ñ–ÑŽ, ÑÐºÑƒ Ð¾Ð±Ñ€Ð°Ð»Ð¸ Ð±Ñ–Ð»ÑŒÑˆÑ–ÑÑ‚ÑŒ Ð¼ÐµÑ‚Ð¾Ð´Ñ–Ð²
#5.	Ð’Ñ–Ð´Ð¾Ð¼Ñ– Ð¹Ð¼Ð¾Ð²Ñ–Ñ€Ð½Ð¾ÑÑ‚Ñ– â†’ Ð¾Ð±Ñ‡Ð¸ÑÐ»ÑŽÑ”Ð¼Ð¾ Ð¾Ñ‡Ñ–ÐºÑƒÐ²Ð°Ð½Ñƒ Ð²Ð¸Ð³Ð¾Ð´Ñƒ Ð´Ð»Ñ ÐºÐ¾Ð¶Ð½Ð¾Ñ— ÑÑ‚Ñ€Ð°Ñ‚ÐµÐ³Ñ–Ñ— Ñ‚Ð° Ð²Ð¸Ð±Ð¸Ñ€Ð°Ñ”Ð¼Ð¾ Ð¼Ð°ÐºÑÐ¸Ð¼Ð°Ð»ÑŒÐ½Ñƒ.
#6.	Ð£ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ñ– Ð¿ÐµÑ€ÐµÐ´Ð±Ð°Ñ‡ÐµÐ½Ð¾ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡Ð½Ðµ Ð¿ÐµÑ€ÐµÑ‚Ð²Ð¾Ñ€ÐµÐ½Ð½Ñ Ð´ÐµÑÑÑ‚ÐºÐ¾Ð²Ð¸Ñ… ÐºÐ¾Ð¼ Ñƒ ÐºÑ€Ð°Ð¿ÐºÐ¸ Ð´Ð»Ñ ÐºÐ¾Ñ€ÐµÐºÑ‚Ð½Ð¾Ð³Ð¾ Ð·Ñ‡Ð¸Ñ‚ÑƒÐ²Ð°Ð½Ð½Ñ Ñ‡Ð¸ÑÐ»Ð¾Ð²Ð¸Ñ… Ð´Ð°Ð½Ð¸Ñ… Ð· Excel.
#7.	ÐŸÑ€Ð¾Ð³Ñ€Ð°Ð¼Ð° Ð¿Ñ€Ð°Ñ†ÑŽÑ” Ð· Ð¼Ð°Ñ‚Ñ€Ð¸Ñ†ÐµÑŽ Ð´Ð¾Ð²Ñ–Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ñ€Ð¾Ð·Ð¼Ñ–Ñ€Ñƒ, Ð° Ñ‚Ð°ÐºÐ¾Ð¶ Ð²Ñ€Ð°Ñ…Ð¾Ð²ÑƒÑ” Ð²Ð¸Ð¿Ð°Ð´ÐºÐ¸, ÐºÐ¾Ð»Ð¸ Ñ‚Ð¾Ñ‡Ð½Ð¾ÑÑ‚Ñ– Ñ–/Ð°Ð±Ð¾ Ñ–Ð¼Ð¾Ð²Ñ–Ñ€Ð½Ð¾ÑÑ‚Ñ– Ð½ÐµÐ²Ñ–Ð´Ð¾Ð¼Ñ–. 
#8.	ÐŸÑ€Ð¾Ð³Ñ€Ð°Ð¼Ð° Ñ–Ð³Ð½Ð¾Ñ€ÑƒÑ” ÐºÐ¾Ð¼Ð¸ Ð² Ð´ÐµÑÑÑ‚ÐºÐ¾Ð²Ð¸Ñ… Ñ‡Ð¸ÑÐ»Ð°Ñ…, Ñ‰Ð¾ ÑÑ‚Ð¾ÑÑ‚ÑŒ Ñƒ Ñ„Ð°Ð¹Ð»Ñ–.

#Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð¸ Ñ€Ð¾Ð±Ð¾Ñ‚Ð¸ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¸ Ð¿Ð¾Ð´Ð°Ð½Ð¾ Ð´Ð»Ñ Ñ‚Ñ€ÑŒÐ¾Ñ… Ð²Ð°Ñ€Ñ–Ð°Ð½Ñ‚Ñ–Ð²:
#1.	Ð’Ñ–Ð´Ð¾Ð¼Ñ– Ñ–Ð¼Ð¾Ð²Ñ–Ñ€Ð½Ð¾ÑÑ‚Ñ– Ñ– Ñ—Ñ… Ñ‚Ð¾Ñ‡Ð½Ð¾ÑÑ‚Ñ–
#2.	Ð’Ñ–Ð´Ð¾Ð¼Ñ– Ñ‚Ñ–Ð»ÑŒÐºÐ¸ Ñ–Ð¼Ð¾Ð²Ñ–Ñ€Ð½Ð¾ÑÑ‚Ñ–
#3.	Ð†Ð¼Ð¾Ð²Ñ–Ñ€Ð½Ð¾ÑÑ‚Ñ– Ð½ÐµÐ²Ñ–Ð´Ð¾Ð¼Ñ–.

import pandas as pd
import numpy as np
from collections import Counter

# ----------------------------
# Ð’Ð²Ñ–Ð´ r Ñ– s
# ----------------------------
while True:
    try:
        r = int(input("Ð’Ð²ÐµÐ´Ñ–Ñ‚ÑŒ ÐºÑ–Ð»ÑŒÐºÑ–ÑÑ‚ÑŒ ÑÑ‚Ñ€Ð°Ñ‚ÐµÐ³Ñ–Ð¹ r: "))
        s = int(input("Ð’Ð²ÐµÐ´Ñ–Ñ‚ÑŒ ÐºÑ–Ð»ÑŒÐºÑ–ÑÑ‚ÑŒ ÑÑ‚Ð°Ð½Ñ–Ð² Ð¿Ñ€Ð¸Ñ€Ð¾Ð´Ð¸ s: "))
        if r > 0 and s > 0:
            break
        else:
            print("r Ñ‚Ð° s Ð¿Ð¾Ð²Ð¸Ð½Ð½Ñ– Ð±ÑƒÑ‚Ð¸ Ð´Ð¾Ð´Ð°Ñ‚Ð½Ñ–")
    except ValueError:
        print("Ð’Ð²ÐµÐ´Ñ–Ñ‚ÑŒ Ñ†Ñ–Ð»Ñ– Ñ‡Ð¸ÑÐ»Ð°")

# ----------------------------
# Ð—Ñ‡Ð¸Ñ‚ÑƒÐ²Ð°Ð½Ð½Ñ Excel
# ----------------------------
file_path = r"D:\A1\theory_of_gaim.xlsx"
df = pd.read_excel(file_path, header=None)

# ----------------------------
# ÐœÐ°Ñ‚Ñ€Ð¸Ñ†Ñ Ð²Ð¸Ð³Ñ€Ð°ÑˆÑ–Ð²
# ----------------------------
payoffs = df.iloc[:r, :s].astype(float).values
payoffs = np.nan_to_num(payoffs, nan=0.0)

# ----------------------------
# Ð™Ð¼Ð¾Ð²Ñ–Ñ€Ð½Ð¾ÑÑ‚Ñ– (Ñ€ÑÐ´Ð¾Ðº r)
# ----------------------------
probabilities = None
if df.shape[0] >= r + 1:
    probabilities = df.iloc[r, :s].astype(float).values
    probabilities = np.nan_to_num(probabilities, nan=0.0)

# ----------------------------
# Ð¢Ð¾Ñ‡Ð½Ð¾ÑÑ‚Ñ– (Ñ€ÑÐ´Ð¾Ðº r+1)
# ----------------------------
accuracy = None
if df.shape[0] >= r + 2:
    accuracy = df.iloc[r + 1, :s].astype(float).values
    accuracy = np.nan_to_num(accuracy, nan=0.0)

# ----------------------------
# Ð’Ð²Ñ–Ð´ Î±
# ----------------------------
while True:
    try:
        alpha = float(input("Ð’Ð²ÐµÐ´Ñ–Ñ‚ÑŒ ÐºÐ¾ÐµÑ„Ñ–Ñ†Ñ–Ñ”Ð½Ñ‚ Ð¾Ð¿Ñ‚Ð¸Ð¼Ñ–Ð·Ð¼Ñƒ Î± (0 â‰¤ Î± â‰¤ 1): "))
        if 0 <= alpha <= 1:
            break
        else:
            print("Î± Ð¼Ð°Ñ” Ð±ÑƒÑ‚Ð¸ Ð¼Ñ–Ð¶ 0 Ñ‚Ð° 1")
    except ValueError:
        print("Ð’Ð²ÐµÐ´Ñ–Ñ‚ÑŒ Ñ‡Ð¸ÑÐ»Ð¾ Ð²Ñ–Ð´ 0 Ð´Ð¾ 1")

# ----------------------------
# Ð Ð¾Ð·Ñ€Ð°Ñ…ÑƒÐ½Ð¾Ðº Ð¿Ð¾ ÑÑ‚Ñ€Ð°Ñ‚ÐµÐ³Ñ–ÑÑ…
# ----------------------------
strategies = [f"A{i+1}" for i in range(r)]

min_vals = np.min(payoffs, axis=1)
max_vals = np.max(payoffs, axis=1)
avg_vals = np.mean(payoffs, axis=1)
hurwicz_vals = alpha * max_vals + (1 - alpha) * min_vals

# ----------------------------
# ÐžÑ‡Ñ–ÐºÑƒÐ²Ð°Ð½Ð° Ð²Ð¸Ð³Ð¾Ð´Ð° (ÑÐºÑ‰Ð¾ Ñ” Ð¹Ð¼Ð¾Ð²Ñ–Ñ€Ð½Ð¾ÑÑ‚Ñ–)
# ----------------------------
expected_values = None
if probabilities is not None and len(probabilities) == s:

    # ÑÐºÑ‰Ð¾ Ñ‚Ð¾Ñ‡Ð½Ñ–ÑÑ‚ÑŒ Ñ” â€” Ð·Ð°ÑÑ‚Ð¾ÑÐ¾Ð²ÑƒÑ”Ð¼Ð¾
    if accuracy is not None and len(accuracy) == s:
        probabilities = probabilities * accuracy

    # Ð±ÐµÐ· Ð½Ð¾Ñ€Ð¼Ð°Ð»Ñ–Ð·Ð°Ñ†Ñ–Ñ—
    expected_values = payoffs.dot(probabilities)

# ----------------------------
# Ð¢Ð°Ð±Ð»Ð¸Ñ†Ñ "Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð¸ Ð¿Ð¾ ÑÑ‚Ñ€Ð°Ñ‚ÐµÐ³Ñ–ÑÑ…"
# ----------------------------
results_by_strategy = pd.DataFrame({
    "Ð¡Ñ‚Ñ€Ð°Ñ‚ÐµÐ³Ñ–Ñ": strategies,
    "min": min_vals,
    "max": max_vals,
    "avg": avg_vals,
    "hurwicz": hurwicz_vals
})

if expected_values is not None:
    results_by_strategy["expected"] = expected_values

print("\nðŸ“Œ Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð¸ Ð¿Ð¾ ÐºÐ¾Ð¶Ð½Ñ–Ð¹ ÑÑ‚Ñ€Ð°Ñ‚ÐµÐ³Ñ–Ñ—:")
print(results_by_strategy)

# ----------------------------
# Ð’Ð¸Ð±Ñ–Ñ€ ÐºÑ€Ð°Ñ‰Ð¸Ñ… ÑÑ‚Ñ€Ð°Ñ‚ÐµÐ³Ñ–Ð¹ Ð¿Ð¾ Ð¼ÐµÑ‚Ð¾Ð´Ð°Ñ…
# ----------------------------
maximin_index = np.argmax(min_vals)
maximax_index = np.argmax(max_vals)
laplace_index = np.argmax(avg_vals)
hurwicz_index = np.argmax(hurwicz_vals)

maximin_strategy = strategies[maximin_index]
maximax_strategy = strategies[maximax_index]
laplace_strategy = strategies[laplace_index]
hurwicz_strategy = strategies[hurwicz_index]

votes = [maximin_strategy, maximax_strategy, laplace_strategy, hurwicz_strategy]
majority_strategy = Counter(votes).most_common(1)[0][0]

methods = [
    "ÐœÐ°ÐºÑÐ¸Ð¼Ñ–Ð½",
    "ÐœÐ°ÐºÑÐ¸Ð¼Ð°ÐºÑ",
    "Ð›Ð°Ð¿Ð»Ð°Ñ",
    f"Ð“ÑƒÑ€Ð²Ñ–Ñ†Ð° (Î± = {alpha})",
    "Ð‘Ñ–Ð»ÑŒÑˆÑ–ÑÑ‚ÑŽ Ð¼ÐµÑ‚Ð¾Ð´Ñ–Ð²"
]

strategies_result = [
    maximin_strategy,
    maximax_strategy,
    laplace_strategy,
    hurwicz_strategy,
    majority_strategy
]

sum_payoff_for_method = [
    float(min_vals[maximin_index]),
    float(max_vals[maximax_index]),
    float(avg_vals[laplace_index]),
    float(hurwicz_vals[hurwicz_index]),
    float(avg_vals[strategies.index(majority_strategy)])
]

# Ð”Ð¾Ð´Ð°Ñ”Ð¼Ð¾ "ÐžÑ‡Ñ–ÐºÑƒÐ²Ð°Ð½Ð° Ð²Ð¸Ð³Ð¾Ð´Ð°"
if expected_values is not None:
    methods.append("ÐžÑ‡Ñ–ÐºÑƒÐ²Ð°Ð½Ð° Ð²Ð¸Ð³Ð¾Ð´Ð°")
    strategies_result.append(strategies[np.argmax(expected_values)])
    sum_payoff_for_method.append(float(expected_values.max()))

results_df = pd.DataFrame({
    "ÐœÐµÑ‚Ð¾Ð´": methods,
    "Ð¡Ñ‚Ñ€Ð°Ñ‚ÐµÐ³Ñ–Ñ": strategies_result,
    "Ð¡ÑƒÐ¼Ð° Ð²Ð¸Ð³Ñ€Ð°ÑˆÑƒ": sum_payoff_for_method
})

# ----------------------------
# Ð—Ð±ÐµÑ€ÐµÐ¶ÐµÐ½Ð½Ñ Ñƒ Ñ„Ð°Ð¹Ð»
# ----------------------------
output_file = r"D:\A1\best_strategy_theory_of_game.xlsx"
results_df.to_excel(output_file, index=False)

print("\nâœ… Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð¸ Ð²Ð¸Ð±Ð¾Ñ€Ñƒ ÑÑ‚Ñ€Ð°Ñ‚ÐµÐ³Ñ–Ð¹:")
print(results_df)
print(f"\nðŸ“ Ð¤Ð°Ð¹Ð» Ð·Ð±ÐµÑ€ÐµÐ¶ÐµÐ½Ð¾: {output_file}")
